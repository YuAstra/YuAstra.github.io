<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ASTRA | ASTRA</title><meta name="author" content="Astra"><meta name="copyright" content="Astra"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="title: java项目(三)date: 2025-03-06 14:47:11tags:这一章将会学习JWT单点登录功能、以及平台功能的完善 3.1date:3.5  使用hutool生成JWT token  1import cn.hutool.jwt.JWTUtil;  这是hutool自带的JWTUtil工具 123456789101112131415161718192021222324">
<meta property="og:type" content="article">
<meta property="og:title" content="ASTRA">
<meta property="og:url" content="http://example.com/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/index.html">
<meta property="og:site_name" content="ASTRA">
<meta property="og:description" content="title: java项目(三)date: 2025-03-06 14:47:11tags:这一章将会学习JWT单点登录功能、以及平台功能的完善 3.1date:3.5  使用hutool生成JWT token  1import cn.hutool.jwt.JWTUtil;  这是hutool自带的JWTUtil工具 123456789101112131415161718192021222324">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-03-06T06:47:11.823Z">
<meta property="article:modified_time" content="2025-03-13T07:49:20.534Z">
<meta property="article:author" content="Astra">
<meta property="article:tag" content="Study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "url": "http://example.com/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/",
  "image": "http://example.com/img/butterfly-icon.png",
  "datePublished": "2025-03-06T06:47:11.823Z",
  "dateModified": "2025-03-13T07:49:20.534Z",
  "author": [
    {
      "@type": "Person",
      "name": "Astra",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ASTRA',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ASTRA</span></a><a class="nav-page-title" href="/"><span class="site-name">ASTRA</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">无标题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-06T06:47:11.823Z" title="发表于 2025-03-06 14:47:11">2025-03-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-13T07:49:20.534Z" title="更新于 2025-03-13 15:49:20">2025-03-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><hr>
<h2 id="title-java项目-三-date-2025-03-06-14-47-11tags"><a href="#title-java项目-三-date-2025-03-06-14-47-11tags" class="headerlink" title="title: java项目(三)date: 2025-03-06 14:47:11tags:"></a>title: java项目(三)<br>date: 2025-03-06 14:47:11<br>tags:</h2><p>这一章将会学习JWT单点登录功能、以及平台功能的完善</p>
<h3 id="3-1"><a href="#3-1" class="headerlink" title="3.1"></a>3.1</h3><p>date:3.5</p>
<blockquote>
<p>使用hutool生成JWT token</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.jwt.JWTUtil;</span><br></pre></td></tr></table></figure>

<p>这是hutool自带的JWTUtil工具</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> MemberLoginResp <span class="title function_">login</span><span class="params">(MemberLoginReq req)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">mobile</span> <span class="operator">=</span>req.getMobile();</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span>req.getCode();</span><br><span class="line">    <span class="type">Member</span> <span class="variable">memberDB</span> <span class="operator">=</span> selectByMobile(mobile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果手机号不存在，则插入一条记录</span></span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNull(memberDB))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(BusinessExceptionEnum. MEMBER_MOBILE_NOT_EXIST);<span class="comment">//抛出异常,具体是手机号为注册，提示用户要先注册</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//校验短信验证码</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="string">&quot;8888&quot;</span>.equals(code))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(BusinessExceptionEnum. MEMBER_MOBILE_CODE_ERROR);<span class="comment">//抛出异常,具体是手机号为注册，提示用户要先注册</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">MemberLoginResp</span> <span class="variable">memberLoginResp</span> <span class="operator">=</span> BeanUtil.copyProperties(memberDB, MemberLoginResp.class);</span><br><span class="line">    Map&lt;String, Object&gt; map = BeanUtil.beanToMap(memberLoginResp);</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;astra&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWTUtil.createToken(map, key.getBytes());</span><br><span class="line">    memberLoginResp.setToken(token);</span><br><span class="line">    <span class="keyword">return</span> memberLoginResp;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>登录逻辑的修改，在登录完成后，在Resp中加入token。<br>Resp中也要加入token，以及其set get方法；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String token;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;MemberLoginResp&#123;&quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;id=&quot;</span>).append(id);</span><br><span class="line">    sb.append(<span class="string">&quot;, mobile=&#x27;&quot;</span>).append(mobile).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;, token=&#x27;&quot;</span>).append(token).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">    sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getToken</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.token = token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-2"><a href="#3-2" class="headerlink" title="3.2"></a>3.2</h3><blockquote>
<p>封装hutool的JWT工具</p>
</blockquote>
<p>把hutool中自带的JWTUtil工具封装成自己的JwtUtil（小写tw）。方便各种项目中使用。</p>
<p>封装类放在common的util下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateField;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateTime;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.crypto.GlobalBouncyCastleProvider;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.jwt.JWTPayload;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.jwt.JWTUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(JwtUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 盐值很重要，不能泄漏，且每个项目都应该不一样，可以放到配置文件中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;astra&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(Long id, String mobile)</span> &#123;</span><br><span class="line">        LOG.info(<span class="string">&quot;开始生成JWT token，id：&#123;&#125;，mobile：&#123;&#125;&quot;</span>, id, mobile);</span><br><span class="line">        GlobalBouncyCastleProvider.setUseBouncyCastle(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span> DateTime.now();</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">expTime</span> <span class="operator">=</span> now.offsetNew(DateField.HOUR, <span class="number">24</span>);</span><br><span class="line">        Map&lt;String, Object&gt; payload = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 签发时间</span></span><br><span class="line">        payload.put(JWTPayload.ISSUED_AT, now);</span><br><span class="line">        <span class="comment">// 过期时间</span></span><br><span class="line">        payload.put(JWTPayload.EXPIRES_AT, expTime);</span><br><span class="line">        <span class="comment">// 生效时间</span></span><br><span class="line">        payload.put(JWTPayload.NOT_BEFORE, now);</span><br><span class="line">        <span class="comment">// 内容</span></span><br><span class="line">        payload.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        payload.put(<span class="string">&quot;mobile&quot;</span>, mobile);</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWTUtil.createToken(payload, key.getBytes());</span><br><span class="line">        LOG.info(<span class="string">&quot;生成JWT token：&#123;&#125;&quot;</span>, token);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">validate</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        LOG.info(<span class="string">&quot;开始JWT token校验，token：&#123;&#125;&quot;</span>, token);</span><br><span class="line">        GlobalBouncyCastleProvider.setUseBouncyCastle(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">JWT</span> <span class="variable">jwt</span> <span class="operator">=</span> JWTUtil.parseToken(token).setKey(key.getBytes());</span><br><span class="line">        <span class="comment">// validate包含了verify</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">validate</span> <span class="operator">=</span> jwt.validate(<span class="number">0</span>);</span><br><span class="line">        LOG.info(<span class="string">&quot;JWT token校验结果：&#123;&#125;&quot;</span>, validate);</span><br><span class="line">        <span class="keyword">return</span> validate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title function_">getJSONObject</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        GlobalBouncyCastleProvider.setUseBouncyCastle(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">JWT</span> <span class="variable">jwt</span> <span class="operator">=</span> JWTUtil.parseToken(token).setKey(key.getBytes());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">payloads</span> <span class="operator">=</span> jwt.getPayloads();</span><br><span class="line">        payloads.remove(JWTPayload.ISSUED_AT);</span><br><span class="line">        payloads.remove(JWTPayload.EXPIRES_AT);</span><br><span class="line">        payloads.remove(JWTPayload.NOT_BEFORE);</span><br><span class="line">        LOG.info(<span class="string">&quot;根据token获取原始内容：&#123;&#125;&quot;</span>, payloads);</span><br><span class="line">        <span class="keyword">return</span> payloads;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        createToken(<span class="number">1L</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYmYiOjE3NDExNzYwNTQsIm1vYmlsZSI6IjEyMyIsImlkIjoxLCJleHAiOjE3NDEyNjI0NTQsImlhdCI6MTc0MTE3NjA1NH0.jgIDO3f3QBgqBRK6UP1QLxEgRKl2BLE7K9pbF_Tf5u8&quot;</span>;</span><br><span class="line">        validate(token);</span><br><span class="line"></span><br><span class="line">        getJSONObject(token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="盐值很重要，是密钥，对token加密，防止别人知道是用的hutool，也用hutool来解密，有密钥就不会简单的被解密。"><a href="#盐值很重要，是密钥，对token加密，防止别人知道是用的hutool，也用hutool来解密，有密钥就不会简单的被解密。" class="headerlink" title="盐值很重要，是密钥，对token加密，防止别人知道是用的hutool，也用hutool来解密，有密钥就不会简单的被解密。"></a>盐值很重要，是密钥，对token加密，防止别人知道是用的hutool，也用hutool来解密，有密钥就不会简单的被解密。</h4><p>封装后每个项目的盐值都可以统一在封装类中管理，不用在每次用到token时都要出现。</p>
<p>每个项目的盐值&#x2F;密钥要不一样，防止被解密。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> Map&lt;String, Object&gt; map = BeanUtil.beanToMap(memberLoginResp);</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;astra&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWTUtil.createToken(map, key.getBytes());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createToken(memberLoginResp.getId(),memberLoginResp.getMobile());</span><br></pre></td></tr></table></figure>

<p>封装自己的JwtUtil后，上面三行可以变为一行。</p>
<hr>
<h3 id="3-3"><a href="#3-3" class="headerlink" title="3.3"></a>3.3</h3><blockquote>
<p>使用vuex(store)来保存登录信息</p>
</blockquote>
<p>在前端web的components下创建the-header.vue。</p>
<p>这样在所有的vue页面只要有&lt;the-header-view&gt;&lt;&#x2F;the-header-view&gt;都能实现效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a-layout-header class=&quot;header&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;logo&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div style=&quot;float: right; color: white;&quot;&gt;</span><br><span class="line">      您好：&#123;&#123;member.mobile&#125;&#125; &amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;router-link to=&quot;/login&quot; style=&quot;color: white;&quot;&gt;</span><br><span class="line">        退出登录</span><br><span class="line">      &lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;a-menu</span><br><span class="line">        v-model:selectedKeys=&quot;selectedKeys&quot;</span><br><span class="line">        theme=&quot;dark&quot;</span><br><span class="line">        mode=&quot;horizontal&quot;</span><br><span class="line">        :style=&quot;&#123; lineHeight: &#x27;64px&#x27; &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;a-menu-item key=&quot;1&quot;&gt;nav 1&lt;/a-menu-item&gt;</span><br><span class="line">      &lt;a-menu-item key=&quot;2&quot;&gt;nav 2&lt;/a-menu-item&gt;</span><br><span class="line">      &lt;a-menu-item key=&quot;3&quot;&gt;nav 3&lt;/a-menu-item&gt;</span><br><span class="line">    &lt;/a-menu&gt;</span><br><span class="line">  &lt;/a-layout-header&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;defineComponent&#125; from &#x27;vue&#x27;;</span><br><span class="line">import store from &quot;@/store&quot;;</span><br><span class="line">// import router from &#x27;@/router&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;the-header-view&quot;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let member = store.state.member;</span><br><span class="line">    // const selectedKeys = ref([]);</span><br><span class="line">    //</span><br><span class="line">    // watch(() =&gt; router.currentRoute.value.path, (newValue) =&gt; &#123;</span><br><span class="line">    //   console.log(&#x27;watch&#x27;, newValue);</span><br><span class="line">    //   selectedKeys.value = [];</span><br><span class="line">    //   selectedKeys.value.push(newValue);</span><br><span class="line">    // &#125;, &#123;immediate: true&#125;);</span><br><span class="line">    return &#123;</span><br><span class="line">      member,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Add &quot;scoped&quot; attribute to limit CSS to this component only --&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.logo &#123;</span><br><span class="line">  float: left;</span><br><span class="line">  height: 31px;</span><br><span class="line">  width: 150px;</span><br><span class="line">  color: white;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>如在控台页面main.vue中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a-layout id=&quot;components-layout-demo-top-side-2&quot;&gt;</span><br><span class="line">    &lt;the-header-view&gt;&lt;/the-header-view&gt;</span><br><span class="line">    &lt;a-layout&gt;</span><br><span class="line">      &lt;a-layout-sider width=&quot;200&quot; style=&quot;background: #fff&quot;&gt;</span><br><span class="line">        &lt;a-menu</span><br><span class="line">            v-model:selectedKeys=&quot;selectedKeys2&quot;</span><br><span class="line">            v-model:openKeys=&quot;openKeys&quot;</span><br><span class="line">            mode=&quot;inline&quot;</span><br><span class="line">            :style=&quot;&#123; height: &#x27;100%&#x27;, borderRight: 0 &#125;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>


<p>在store中配置member。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;  <span class="comment">//全局变量</span></span><br><span class="line">    <span class="attr">member</span>:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setMember</span> (state, _member)&#123;</span><br><span class="line">      state.<span class="property">member</span>=_member;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>mutations是同步的，相当于构造member对象。</p>
<p>在前端login成功后，要将从后端得到的member的信息提交到store：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">login</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/member/member/login&quot;</span>,loginForm).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> data = response.<span class="property">data</span>; <span class="comment">//response.data==后端的CommonResp</span></span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">success</span>)&#123;</span><br><span class="line">      notification.<span class="title function_">success</span>(&#123; <span class="attr">description</span>:<span class="string">&#x27;登录成功！&#x27;</span>&#125;)</span><br><span class="line">      <span class="comment">//登录成功，调到控台主页</span></span><br><span class="line">      router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="string">&quot;setMember&quot;</span>,data.<span class="property">content</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      notification.<span class="title function_">error</span>(&#123; <span class="attr">description</span>:data.<span class="property">message</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-4"><a href="#3-4" class="headerlink" title="3.4"></a>3.4</h3><blockquote>
<p>vuex配合h5 session缓存，解决浏览器刷新后丢失数据的问题</p>
</blockquote>
<h4 id="在之前store中存储的数据相当于只是缓存了一下，而页面刷新后、或是跳转其他页面，原保存的数据就会丢失。"><a href="#在之前store中存储的数据相当于只是缓存了一下，而页面刷新后、或是跳转其他页面，原保存的数据就会丢失。" class="headerlink" title="在之前store中存储的数据相当于只是缓存了一下，而页面刷新后、或是跳转其他页面，原保存的数据就会丢失。"></a>在之前store中存储的数据相当于只是缓存了一下，而页面刷新后、或是跳转其他页面，原保存的数据就会丢失。</h4><p>因此用session来作缓存。</p>
<p>在store中对member变量作修改，让其尝试获取session中的MEMBER值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MEMBER</span> = <span class="string">&quot;MEMBER&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;  <span class="comment">//全局变量</span></span><br><span class="line">    <span class="attr">member</span>: <span class="variable language_">window</span>.<span class="property">SessionStorage</span>.<span class="title function_">get</span>(<span class="variable constant_">MEMBER</span>) || &#123;&#125; <span class="comment">//避免空指针异常</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setMember</span> (state, _member)&#123;</span><br><span class="line">      state.<span class="property">member</span>=_member;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">SessionStorage</span>.<span class="title function_">set</span>(<span class="variable constant_">MEMBER</span>,_member);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果session中能get到MEMBER说明已经登录过了，有该用户的信息。如果没有登录过，会创建一个空对象，避免了空指针异常。</p>
<p>在web的public下的index.html的&lt;head&gt;中加入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;&lt;%= BASE_URL %&gt;js/session-storage.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这样所有的script都会运用到session-storage.js文件。</p>
<p><strong>注意：</strong></p>
<h4 id="是个特例，一定要和匹配。"><a href="#是个特例，一定要和匹配。" class="headerlink" title="&lt;script&gt;是个特例，一定要和&lt;&#x2F;script&gt;匹配。"></a><strong>&lt;script&gt;是个特例，一定要和&lt;&#x2F;script&gt;匹配。</strong></h4><p><strong>如果只用&lt;script&#x2F;&gt;会导致错误，可能是为了便于防止脚本的跨站流入攻击，毕竟过滤一个&lt;script&gt; &lt;&#x2F;script&gt; 比过滤具有多种表现模式的 &lt;script&gt;标签要简单一些。</strong></p>
<p>public中放入session-storage.js文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有的session key都在这里统一定义，可以避免多个功能使用同一个key</span></span><br><span class="line"><span class="variable constant_">SESSION_ORDER</span> = <span class="string">&quot;SESSION_ORDER&quot;</span>;</span><br><span class="line"><span class="variable constant_">SESSION_TICKET_PARAMS</span> = <span class="string">&quot;SESSION_TICKET_PARAMS&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">SessionStorage</span> = &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> v = <span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (v &amp;&amp; <span class="title function_">typeof</span>(v) !== <span class="string">&quot;undefined&quot;</span> &amp;&amp; v !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">key, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">remove</span>: <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="variable language_">sessionStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">clearAll</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">sessionStorage</span>.<span class="title function_">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>包含了session的各种方法。</p>
<hr>
<h3 id="3-5"><a href="#3-5" class="headerlink" title="3.5"></a>3.5</h3><blockquote>
<p>演示gateway过滤器的使用</p>
</blockquote>
<p>gateway config下创建Test1Filter和Test2Filter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1Filter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(Test1Filter.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        LOG.info(<span class="string">&quot;Test1Filter&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange); <span class="comment">//固定写法，继续下一个过滤器</span></span><br><span class="line">        <span class="comment">//return exchange.getResponse().setComplete(); //若要结束过滤器就这样写</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2Filter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(Test2Filter.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        LOG.info(<span class="string">&quot;Test2Filter&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange); <span class="comment">//固定写法，继续下一个过滤器</span></span><br><span class="line">        <span class="comment">//return exchange.getResponse().setComplete(); //若要结束过滤器就这样写</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="测试表明，多个gateway过滤器的顺序是按照Ordered接口中的getOrder-方法返回的数值从小到大执行的。"><a href="#测试表明，多个gateway过滤器的顺序是按照Ordered接口中的getOrder-方法返回的数值从小到大执行的。" class="headerlink" title="测试表明，多个gateway过滤器的顺序是按照Ordered接口中的getOrder()方法返回的数值从小到大执行的。"></a><strong>测试表明，多个gateway过滤器的顺序是按照Ordered接口中的getOrder()方法返回的数值从小到大执行的。</strong></h4><hr>
<h3 id="3-6"><a href="#3-6" class="headerlink" title="3.6"></a>3.6</h3><blockquote>
<p>为gateway增加登录校验过滤器</p>
</blockquote>
<p>LoginMemberFilter.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.star.gateway.util.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//会员端的登录验证</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMemberFilter</span> <span class="keyword">implements</span> <span class="title class_">Ordered</span>, GlobalFilter &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(LoginMemberFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequest().getURI().getPath();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 排除不需要拦截的请求</span></span><br><span class="line">        <span class="keyword">if</span> (path.contains(<span class="string">&quot;/admin&quot;</span>) <span class="comment">//管理员的接口，另一套逻辑</span></span><br><span class="line"><span class="comment">//                || path.contains(&quot;/redis&quot;)</span></span><br><span class="line">                || path.contains(<span class="string">&quot;/hello&quot;</span>)  <span class="comment">//测试接口</span></span><br><span class="line">                || path.contains(<span class="string">&quot;/member/member/login&quot;</span>)    <span class="comment">//未登录的接口不需要拦截</span></span><br><span class="line">                || path.contains(<span class="string">&quot;/member/member/send-code&quot;</span>)<span class="comment">//未登录的接口不需要拦截</span></span><br><span class="line"><span class="comment">//                || path.contains(&quot;/business/kaptcha&quot;)</span></span><br><span class="line">                ) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;不需要登录验证：&#123;&#125;&quot;</span>, path);</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;需要登录验证：&#123;&#125;&quot;</span>, path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取header的token参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> exchange.getRequest().getHeaders().getFirst(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        LOG.info(<span class="string">&quot;会员登录验证开始，token：&#123;&#125;&quot;</span>, token);</span><br><span class="line">        <span class="keyword">if</span> (token == <span class="literal">null</span> || token.isEmpty()) &#123;</span><br><span class="line">            LOG.info( <span class="string">&quot;token为空，请求被拦截&quot;</span> );</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 校验token是否有效，包括token是否被改过，是否过期</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">validate</span> <span class="operator">=</span> JwtUtil.validate(token);</span><br><span class="line">        <span class="keyword">if</span> (validate) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;token有效，放行该请求&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOG.warn( <span class="string">&quot;token无效，请求被拦截&quot;</span> );</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 优先级设置  值越小  优先级越高</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gateway模块中也加入JwtUtil封装</p>
<hr>
<h3 id="3-7"><a href="#3-7" class="headerlink" title="3.7"></a>3.7</h3><blockquote>
<p>为axios增加登录相关拦截，请求时带上token，返回时校验返回码是不是401</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios拦截器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求参数：&#x27;</span>, config);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> _token=store.<span class="property">state</span>.<span class="property">member</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="keyword">if</span>(_token)&#123;</span><br><span class="line">        config.<span class="property">headers</span>.<span class="property">token</span>=_token;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求headers增加token:&quot;</span>,_token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;返回结果:&#x27;</span>,response);</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;返回错误:&#x27;</span>,error);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> response=error.<span class="property">response</span>;</span><br><span class="line">    <span class="keyword">const</span> status=response.<span class="property">status</span>;</span><br><span class="line">    <span class="keyword">if</span>(status===<span class="number">401</span>)&#123;</span><br><span class="line">        <span class="comment">//判断状态码是401 跳转到登录页</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;未登录或登录超时，跳到登录页&quot;</span>);</span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="string">&quot;setMember&quot;</span>,&#123;&#125;);</span><br><span class="line">        notification.<span class="title function_">error</span>(&#123;<span class="attr">description</span>:<span class="string">&quot;未登录或登录超时&quot;</span>&#125;);</span><br><span class="line">        router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-8"><a href="#3-8" class="headerlink" title="3.8"></a>3.8</h3><blockquote>
<p>增加路由登录拦截，访问所有的控台页面都需要登录</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="comment">//name: &#x27;main&#x27;,</span></span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/main.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;</span><br><span class="line">    <span class="attr">loginRequire</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由登录拦截 拦截与后端没有交互的页面，如未登录状态下去访问本不允许访问的静态页面，让其跳转到登录页面。</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 要不要对meta.loginRequire属性做监控拦截</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">matched</span>.<span class="title function_">some</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item, <span class="string">&quot;是否需要登录校验：&quot;</span>, item.<span class="property">meta</span>.<span class="property">loginRequire</span> || <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">meta</span>.<span class="property">loginRequire</span></span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    <span class="keyword">const</span> _member = store.<span class="property">state</span>.<span class="property">member</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;页面登录校验开始：&quot;</span>, _member);</span><br><span class="line">    <span class="keyword">if</span> (!_member.<span class="property">token</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户未登录或登录超时！&quot;</span>);</span><br><span class="line">      notification.<span class="title function_">error</span>(&#123; <span class="attr">description</span>: <span class="string">&quot;未登录或登录超时&quot;</span> &#125;);</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-9"><a href="#3-9" class="headerlink" title="3.9"></a>3.9</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> `spectator`;</span><br><span class="line"><span class="keyword">create table</span> `spectator`(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not null</span> comment <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    `member_id` <span class="type">bigint</span> <span class="keyword">not null</span> comment <span class="string">&#x27;会员id&#x27;</span>,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    `id_card` <span class="type">varchar</span>(<span class="number">18</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;身份证&#x27;</span>,</span><br><span class="line">    `type` <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;观众类型|枚举[SpectatorTypeEnum]&#x27;</span>,</span><br><span class="line">    `create_time` datetime(<span class="number">3</span>) comment <span class="string">&#x27;新增时间&#x27;</span>,</span><br><span class="line">    `update_time` datetime(<span class="number">3</span>) comment <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    <span class="keyword">primary key</span> (`id`),</span><br><span class="line">    index `member_id_index` (`member_id`)</span><br><span class="line">)   engine<span class="operator">=</span>innodb <span class="keyword">default</span>  charset<span class="operator">=</span>utf8mb4 comment<span class="operator">=</span><span class="string">&#x27;观众&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>建立spectator观赛人表</p>
<p>并用generator插件生成持久层代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;spectator&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Spectator&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>会生成spectator.java 和spectatorExample.java，以及Mapper.java 和Mapper.xml映射文件，这步和之前穿件memebr表一样。</p>
<hr>
<h3 id="4-1"><a href="#4-1" class="headerlink" title="4.1"></a>4.1</h3><blockquote>
<p>增加观众类型枚举</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.EnumSet;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">SpectatorTypeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    ADULT(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;成人&quot;</span>),</span><br><span class="line">    CHILD(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;儿童&quot;</span>),</span><br><span class="line">    STUDENT(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;学生&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    SpectatorTypeEnum(String code, String desc) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDesc</span><span class="params">(String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;HashMap&lt;String,String&gt;&gt; <span class="title function_">getEnumList</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;HashMap&lt;String, String&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SpectatorTypeEnum anEnum : EnumSet.allOf(SpectatorTypeEnum.class)) &#123;</span><br><span class="line">            HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;code&quot;</span>,anEnum.code);</span><br><span class="line">            map.put(<span class="string">&quot;desc&quot;</span>,anEnum.desc);</span><br><span class="line">            list.add(map);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-2"><a href="#4-2" class="headerlink" title="4.2"></a>4.2</h3><blockquote>
<p>增加观众新增接口</p>
</blockquote>
<p>http测试请求初步为：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8001/member/spectator/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;memberId&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;test&quot;,</span><br><span class="line">  &quot;idCard&quot;: &quot;123321&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###</span><br></pre></td></tr></table></figure>

<p>service层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateTime;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.util.SnowUtil;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.domain.Spectator;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.mapper.SpectatorMapper;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorSaveReq;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SpectatorMapper spectatorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(SpectatorSaveReq req)</span>&#123;</span><br><span class="line">        <span class="type">Spectator</span> <span class="variable">spectator</span> <span class="operator">=</span> BeanUtil.copyProperties(req, Spectator.class);</span><br><span class="line">        spectator.setId(SnowUtil.getSnowflakeNextId());</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span>DateTime.now();</span><br><span class="line">        spectator.setCreateTime(now);</span><br><span class="line">        spectator.setUpdateTime(now);</span><br><span class="line">        spectatorMapper.insert(spectator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>save动作的Req请求类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.req;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorSaveReq</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long memberId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getMemberId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemberId</span><span class="params">(Long memberId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memberId = memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIdCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdCard</span><span class="params">(String idCard)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.idCard = idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateTime</span><span class="params">(Date createTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getUpdateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpdateTime</span><span class="params">(Date updateTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateTime = updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(getClass().getSimpleName());</span><br><span class="line">        sb.append(<span class="string">&quot; [&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Hash = &quot;</span>).append(hashCode());</span><br><span class="line">        sb.append(<span class="string">&quot;, id=&quot;</span>).append(id);</span><br><span class="line">        sb.append(<span class="string">&quot;, memberId=&quot;</span>).append(memberId);</span><br><span class="line">        sb.append(<span class="string">&quot;, name=&quot;</span>).append(name);</span><br><span class="line">        sb.append(<span class="string">&quot;, idCard=&quot;</span>).append(idCard);</span><br><span class="line">        sb.append(<span class="string">&quot;, type=&quot;</span>).append(type);</span><br><span class="line">        sb.append(<span class="string">&quot;, createTime=&quot;</span>).append(createTime);</span><br><span class="line">        sb.append(<span class="string">&quot;, updateTime=&quot;</span>).append(updateTime);</span><br><span class="line">        sb.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初步控制层代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.CommonResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorSaveReq;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.service.SpectatorService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> jakarta.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/spectator&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SpectatorService spectatorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResp&lt;Object&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> SpectatorSaveReq req)</span>&#123;</span><br><span class="line">        spectatorService.save (req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResp</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-2-2"><a href="#4-2-2" class="headerlink" title="4.2(2)"></a>4.2(2)</h3><blockquote>
<p>增加观众新增接口，增加字段校验</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.req;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorSaveReq</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;【会员ID】不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long memberId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;【名字】不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;【身份证】不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;【观众类型】不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getMemberId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemberId</span><span class="params">(Long memberId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memberId = memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIdCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdCard</span><span class="params">(String idCard)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.idCard = idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateTime</span><span class="params">(Date createTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getUpdateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpdateTime</span><span class="params">(Date updateTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateTime = updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(getClass().getSimpleName());</span><br><span class="line">        sb.append(<span class="string">&quot; [&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Hash = &quot;</span>).append(hashCode());</span><br><span class="line">        sb.append(<span class="string">&quot;, id=&quot;</span>).append(id);</span><br><span class="line">        sb.append(<span class="string">&quot;, memberId=&quot;</span>).append(memberId);</span><br><span class="line">        sb.append(<span class="string">&quot;, name=&quot;</span>).append(name);</span><br><span class="line">        sb.append(<span class="string">&quot;, idCard=&quot;</span>).append(idCard);</span><br><span class="line">        sb.append(<span class="string">&quot;, type=&quot;</span>).append(type);</span><br><span class="line">        sb.append(<span class="string">&quot;, createTime=&quot;</span>).append(createTime);</span><br><span class="line">        sb.append(<span class="string">&quot;, updateTime=&quot;</span>).append(updateTime);</span><br><span class="line">        sb.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>各属性加上了注解，确保输入不能为空。</p>
<h4 id="注：memberId是Long类型，不能用-NotBlank，而应该用-NotNull"><a href="#注：memberId是Long类型，不能用-NotBlank，而应该用-NotNull" class="headerlink" title="注：memberId是Long类型，不能用@NotBlank，而应该用@NotNull"></a><strong>注：memberId是Long类型，不能用@NotBlank，而应该用@NotNull</strong></h4><hr>
<h3 id="4-3"><a href="#4-3" class="headerlink" title="4.3"></a>4.3</h3><blockquote>
<p>使用IDEA自带的HttpClient记住登录的信息</p>
</blockquote>
<p>在http登录请求后加入client，将登录后生成的token放入全局client中：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8000/member/member/login</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;mobile&quot;: &quot;13000000000&quot;,</span><br><span class="line">  &quot;code&quot;: &quot;8888&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; &#123;%</span><br><span class="line">client.log(JSON.stringify(response.body));</span><br><span class="line">client.log(JSON.stringify(response.body.content.token));</span><br><span class="line">client.global.set(&quot;token&quot;,response.body.content.token);</span><br><span class="line"></span><br><span class="line"> %&#125;</span><br><span class="line">###</span><br></pre></td></tr></table></figure>

<p>在其他http请求时也要带上token，才能访问后端。client中存有token后可以直接使用变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8000/member/spectator/save</span><br><span class="line">Content-Type: application/json</span><br><span class="line">token: &#123;&#123;token&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;memberId&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;test&quot;,</span><br><span class="line">  &quot;idCard&quot;: &quot;123321&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-4"><a href="#4-4" class="headerlink" title="4.4"></a>4.4</h3><blockquote>
<p>使用线程本地变量存储会员信息</p>
</blockquote>
<p>Common中加入以下几个文件：</p>
<p>MemberLoginResp.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.resp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberLoginResp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;MemberLoginResp&#123;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;id=&quot;</span>).append(id);</span><br><span class="line">        sb.append(<span class="string">&quot;, mobile=&#x27;&quot;</span>).append(mobile).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;, token=&#x27;&quot;</span>).append(token).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getToken</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMobile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mobile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMobile</span><span class="params">(String mobile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mobile = mobile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MemberInterceptor.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.MemberLoginResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.util.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.contxet.LoginMemberContext;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拦截器：Spring框架特有的，常用于登录校验，权限校验，请求日志打印</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(MemberInterceptor.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        LOG.info(<span class="string">&quot;MemberInterceptor开始&quot;</span>);</span><br><span class="line">        <span class="comment">//获取header的token参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(token)) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;获取会员登录token：&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">loginMember</span> <span class="operator">=</span> JwtUtil.getJSONObject(token);</span><br><span class="line">            LOG.info(<span class="string">&quot;当前登录会员：&#123;&#125;&quot;</span>, loginMember);</span><br><span class="line">            <span class="type">MemberLoginResp</span> <span class="variable">member</span> <span class="operator">=</span> JSONUtil.toBean(loginMember, MemberLoginResp.class);</span><br><span class="line">            LoginMemberContext.setMember(member);</span><br><span class="line">        &#125;</span><br><span class="line">        LOG.info(<span class="string">&quot;MemberInterceptor结束&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Interceptor作为拦截器，获取当前登录的用户的信息以及token，并存储。</p>
<p>LoginMemberContext.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.contxet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.MemberLoginResp;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMemberContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(LoginMemberContext.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;MemberLoginResp&gt; member = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MemberLoginResp <span class="title function_">getMember</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> member.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setMember</span><span class="params">(MemberLoginResp member)</span> &#123;</span><br><span class="line">        LoginMemberContext.member.set(member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> member.get().getId();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;获取登录会员信息异常&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>context上下文</p>
<p>Member模块中加入SpringMvcConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.star.xsport.common.interceptor.LogInterceptor;</span></span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.interceptor.MemberInterceptor;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   @Resource</span></span><br><span class="line"><span class="comment">//   LogInterceptor logInterceptor;</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   MemberInterceptor memberInterceptor;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line"><span class="comment">//       registry.addInterceptor(logInterceptor);</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 路径不要包含context-path</span></span><br><span class="line">       registry.addInterceptor(memberInterceptor)</span><br><span class="line">               .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">               .excludePathPatterns(</span><br><span class="line">                       <span class="string">&quot;/hello&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/member/send-code&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/member/login&quot;</span></span><br><span class="line">               );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用于开启拦截器。</p>
<hr>
<h3 id="4-5"><a href="#4-5" class="headerlink" title="4.5"></a>4.5</h3><blockquote>
<p>增加日志拦截器，统一打印日志流水号</p>
</blockquote>
<p>Common的Intercept中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.RandomUtil;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.MDC;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志拦截器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 增加日志流水号</span></span><br><span class="line">        MDC.put(<span class="string">&quot;LOG_ID&quot;</span>, System.currentTimeMillis() + RandomUtil.randomString(<span class="number">3</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.interceptor.LogInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.interceptor.MemberInterceptor;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   LogInterceptor logInterceptor;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   MemberInterceptor memberInterceptor;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">       registry.addInterceptor(logInterceptor);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 路径不要包含context-path</span></span><br><span class="line">       registry.addInterceptor(memberInterceptor)</span><br><span class="line">               .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">               .excludePathPatterns(</span><br><span class="line">                       <span class="string">&quot;/hello&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/member/send-code&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/member/login&quot;</span></span><br><span class="line">               );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这样日志流水号也是通用的了，在各个模块中开启就可以。</p>
<hr>
<h3 id="4-6"><a href="#4-6" class="headerlink" title="4.6"></a>4.6</h3><blockquote>
<p>制作欢迎页面，增加观赛人管理页面，修改菜单，实现页面切换</p>
</blockquote>
<p>纯前端。</p>
<h3 id="4-6-2"><a href="#4-6-2" class="headerlink" title="4.6(2)"></a>4.6(2)</h3><blockquote>
<p>实现菜单同步激活</p>
</blockquote>
<p>theheader.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selectedKeys = <span class="title function_">ref</span>([]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> router.<span class="property">currentRoute</span>.<span class="property">value</span>.<span class="property">path</span>, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watch&#x27;</span>, newValue);</span><br><span class="line">  selectedKeys.<span class="property">value</span> = [];  <span class="comment">//先清空再push</span></span><br><span class="line">  selectedKeys.<span class="property">value</span>.<span class="title function_">push</span>(newValue);</span><br><span class="line">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>thesider.vue</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> <span class="title function_">defineComponent</span><span class="params">(&#123;</span></span><br><span class="line"><span class="params">  name: <span class="string">&quot;the-sider-view&quot;</span>,</span></span><br><span class="line"><span class="params">  setup()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">selectedKeys</span> <span class="operator">=</span> ref([]);</span><br><span class="line"></span><br><span class="line">    watch(() =&gt; router.currentRoute.value.path, (newValue) =&gt; &#123;</span><br><span class="line">      console.log(<span class="string">&#x27;watch&#x27;</span>, newValue);</span><br><span class="line">      selectedKeys.value = [];  <span class="comment">//先清空再push</span></span><br><span class="line">      selectedKeys.value.push(newValue);</span><br><span class="line">    &#125;, &#123;immediate: <span class="literal">true</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      selectedKeys</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-7"><a href="#4-7" class="headerlink" title="4.7"></a>4.7</h3><blockquote>
<p>观影人新增界面开发，增加【新增】按钮，点击弹出Modal</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a-button type=&quot;primary&quot; @click=&quot;showModal&quot;&gt;新增&lt;/a-button&gt;</span><br><span class="line">  &lt;a-modal v-model:visible=&quot;visible&quot; title=&quot;观赛人&quot; @ok=&quot;handleOk&quot;&gt;</span><br><span class="line">    &lt;p&gt;Some contents&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Some contents&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Some contents&lt;/p&gt;</span><br><span class="line">  &lt;/a-modal&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; defineComponent,ref &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;passenger-view&quot;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const visible=ref(false);</span><br><span class="line"></span><br><span class="line">    const showModal =()=&gt;&#123;</span><br><span class="line">      visible.value=true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const handleOk =e=&gt;&#123;</span><br><span class="line">      console.log(e);</span><br><span class="line">      visible.value=false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      visible,</span><br><span class="line">      showModal,</span><br><span class="line">      handleOk,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-7-2"><a href="#4-7-2" class="headerlink" title="4.7(2)"></a>4.7(2)</h3><blockquote>
<p>观众新增界面开发，增加表单内容</p>
</blockquote>
<h3 id="4-7-3"><a href="#4-7-3" class="headerlink" title="4.7(3)"></a>4.7(3)</h3><blockquote>
<p>观众新增界面开发，完成保存功能</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a-button type=&quot;primary&quot; @click=&quot;showModal&quot;&gt;新增&lt;/a-button&gt;</span><br><span class="line">  &lt;a-modal v-model:visible=&quot;visible&quot; title=&quot;观赛人&quot; @ok=&quot;handleOk&quot; ok-text=&quot;确认&quot; cancel-text=&quot;取消&quot;&gt;</span><br><span class="line">    &lt;a-form :model=&quot;spectator&quot; :label-col=&quot;&#123;span: 4&#125;&quot; :wrapper-col=&quot;&#123;&#125;&quot;&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;姓名&quot;&gt;</span><br><span class="line">        &lt;a-input v-model:value=&quot;spectator.name&quot;/&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;身份证&quot;&gt;</span><br><span class="line">        &lt;a-input v-model:value=&quot;spectator.idCard&quot;/&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;类型&quot;&gt;</span><br><span class="line">        &lt;a-select v-model:value=&quot;spectator.type&quot;&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;1&quot;&gt;成人&lt;/a-select-option&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;2&quot;&gt;儿童&lt;/a-select-option&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;3&quot;&gt;学生&lt;/a-select-option&gt;</span><br><span class="line">        &lt;/a-select&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">    &lt;/a-form&gt;</span><br><span class="line">  &lt;/a-modal&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; defineComponent,ref,reactive &#125; from &#x27;vue&#x27;;</span><br><span class="line">import axios from &quot;axios&quot;;</span><br><span class="line">import &#123;notification&#125; from &quot;ant-design-vue&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;passenger-view&quot;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const visible=ref(false);</span><br><span class="line"></span><br><span class="line">    const spectator = reactive(&#123;</span><br><span class="line">      id: undefined,</span><br><span class="line">      memberId: undefined,</span><br><span class="line">      name: undefined,</span><br><span class="line">      idCard:undefined,</span><br><span class="line">      type: undefined,</span><br><span class="line">      createTime:undefined,</span><br><span class="line">      updateTime:undefined,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const showModal =()=&gt;&#123;</span><br><span class="line">      visible.value=true;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const handleOk =()=&gt;&#123;</span><br><span class="line">      axios.post(&quot;/member/spectator/save&quot;,spectator).then((response)=&gt;&#123;</span><br><span class="line">        let data=response.data;</span><br><span class="line">        if(data.success)&#123;</span><br><span class="line">          notification.success(&#123;description:&quot;添加成功&quot;&#125;);</span><br><span class="line">          visible.value=false;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">          notification.error(&#123;description:data.message&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      visible,</span><br><span class="line">      spectator,</span><br><span class="line">      showModal,</span><br><span class="line">      handleOk,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-8"><a href="#4-8" class="headerlink" title="4.8"></a>4.8</h3><blockquote>
<p>增加乘车人列表查询接口，只能查看当前会员自己添加的乘客</p>
</blockquote>
<p>http请求</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8000/member/spectator/query-list</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">token</span><span class="punctuation">: </span>&#123;&#123;token&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>spectator有关的逻辑：</p>
<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;SpectatorQueryResp&gt; <span class="title function_">queryList</span><span class="params">(SpectatorQueryReq req)</span>&#123;</span><br><span class="line">    <span class="type">SpectatorExample</span> <span class="variable">spectatorExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpectatorExample</span>();</span><br><span class="line">    SpectatorExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> spectatorExample.createCriteria();</span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNotNull(req.getMemberId()))&#123;</span><br><span class="line">        criteria.andMemberIdEqualTo(req.getMemberId());</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Spectator&gt; spectatorList = spectatorMapper.selectByExample(spectatorExample);</span><br><span class="line">    <span class="keyword">return</span> BeanUtil.copyToList(spectatorList, SpectatorQueryResp.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpectatorQueryResp.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.resp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorQueryResp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long memberId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getMemberId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemberId</span><span class="params">(Long memberId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memberId = memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIdCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdCard</span><span class="params">(String idCard)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.idCard = idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateTime</span><span class="params">(Date createTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getUpdateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpdateTime</span><span class="params">(Date updateTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateTime = updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(getClass().getSimpleName());</span><br><span class="line">        sb.append(<span class="string">&quot; [&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Hash = &quot;</span>).append(hashCode());</span><br><span class="line">        sb.append(<span class="string">&quot;, id=&quot;</span>).append(id);</span><br><span class="line">        sb.append(<span class="string">&quot;, memberId=&quot;</span>).append(memberId);</span><br><span class="line">        sb.append(<span class="string">&quot;, name=&quot;</span>).append(name);</span><br><span class="line">        sb.append(<span class="string">&quot;, idCard=&quot;</span>).append(idCard);</span><br><span class="line">        sb.append(<span class="string">&quot;, type=&quot;</span>).append(type);</span><br><span class="line">        sb.append(<span class="string">&quot;, createTime=&quot;</span>).append(createTime);</span><br><span class="line">        sb.append(<span class="string">&quot;, updateTime=&quot;</span>).append(updateTime);</span><br><span class="line">        sb.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpectatorQueryReq.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.req;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorQueryReq</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long memberId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getMemberId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemberId</span><span class="params">(Long memberId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memberId = memberId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;SpectatorQueryReq&#123;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;memberId=&quot;</span>).append(memberId);</span><br><span class="line">        sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/query-list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResp&lt;List&lt;SpectatorQueryResp&gt;&gt; <span class="title function_">queryList</span><span class="params">(<span class="meta">@Valid</span> SpectatorQueryReq req)</span>&#123;</span><br><span class="line">    req.setMemberId(LoginMemberContext.getId());</span><br><span class="line">    List&lt;SpectatorQueryResp&gt; list=spectatorService.queryList (req);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResp</span>&lt;&gt;(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-9"><a href="#4-9" class="headerlink" title="4.9"></a>4.9</h3><blockquote>
<p>继承PageHelper,实现sql分页功能</p>
</blockquote>
<p>父pom加入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>common 的pom中引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>service层中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;SpectatorQueryResp&gt; <span class="title function_">queryList</span><span class="params">(SpectatorQueryReq req)</span>&#123;</span><br><span class="line">    <span class="type">SpectatorExample</span> <span class="variable">spectatorExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpectatorExample</span>();</span><br><span class="line">    SpectatorExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> spectatorExample.createCriteria();</span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNotNull(req.getMemberId()))&#123;</span><br><span class="line">        criteria.andMemberIdEqualTo(req.getMemberId());</span><br><span class="line">    &#125;</span><br><span class="line">    PageHelper.startPage(<span class="number">2</span>,<span class="number">2</span>); <span class="comment">//对这句往下遇到的第一个SQL做拦截，增加分页limit</span></span><br><span class="line">    List&lt;Spectator&gt; spectatorList = spectatorMapper.selectByExample(spectatorExample);</span><br><span class="line">    <span class="keyword">return</span> BeanUtil.copyToList(spectatorList, SpectatorQueryResp.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PageHelper会将下一句sql做拦截，在sql语句中增加分页limit。</p>
<hr>
<h3 id="4-9-2"><a href="#4-9-2" class="headerlink" title="4.9(2)"></a>4.9(2)</h3><blockquote>
<p>封装分页请求参数</p>
</blockquote>
<h3 id="4-9-3"><a href="#4-9-3" class="headerlink" title="4.9(3)"></a>4.9(3)</h3><blockquote>
<p> 封装分页返回结果</p>
</blockquote>
<h3 id="4-9-4"><a href="#4-9-4" class="headerlink" title="4.9(4)"></a>4.9(4)</h3><blockquote>
<p>格式化返回的日期字段</p>
</blockquote>
<p>最终结果：</p>
<p>SpectatorService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateTime;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ObjectUtil;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageInfo;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.contxet.LoginMemberContext;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.PageResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.util.SnowUtil;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.domain.Spectator;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.domain.SpectatorExample;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.mapper.SpectatorMapper;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorQueryReq;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorSaveReq;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.resp.SpectatorQueryResp;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(SpectatorService.class);</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SpectatorMapper spectatorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(SpectatorSaveReq req)</span>&#123;</span><br><span class="line">        <span class="type">Spectator</span> <span class="variable">spectator</span> <span class="operator">=</span> BeanUtil.copyProperties(req, Spectator.class);</span><br><span class="line">        spectator.setMemberId(LoginMemberContext.getId());</span><br><span class="line">        spectator.setId(SnowUtil.getSnowflakeNextId());</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span>DateTime.now();</span><br><span class="line">        spectator.setCreateTime(now);</span><br><span class="line">        spectator.setUpdateTime(now);</span><br><span class="line">        spectatorMapper.insert(spectator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PageResp&lt;SpectatorQueryResp&gt; <span class="title function_">queryList</span><span class="params">(SpectatorQueryReq req)</span>&#123;</span><br><span class="line">        <span class="type">SpectatorExample</span> <span class="variable">spectatorExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpectatorExample</span>();</span><br><span class="line">        SpectatorExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> spectatorExample.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtil.isNotNull(req.getMemberId()))&#123;</span><br><span class="line">            criteria.andMemberIdEqualTo(req.getMemberId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOG.info(<span class="string">&quot;查询页码:&#123;&#125;&quot;</span>,req.getPage());</span><br><span class="line">        LOG.info(<span class="string">&quot;每页条数:&#123;&#125;&quot;</span>,req.getSize());</span><br><span class="line"></span><br><span class="line">        PageHelper.startPage(req.getPage(),req.getSize()); <span class="comment">//对这句往下遇到的第一个SQL做拦截，增加分页limit</span></span><br><span class="line">        List&lt;Spectator&gt; spectatorList = spectatorMapper.selectByExample(spectatorExample);</span><br><span class="line"></span><br><span class="line">        PageInfo&lt;Spectator&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(spectatorList);</span><br><span class="line">        LOG.info(<span class="string">&quot;总行数:&#123;&#125;&quot;</span>,pageInfo.getTotal());</span><br><span class="line">        LOG.info(<span class="string">&quot;总页数:&#123;&#125;&quot;</span>,pageInfo.getPages());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;SpectatorQueryResp&gt; list = BeanUtil.copyToList(spectatorList, SpectatorQueryResp.class);</span><br><span class="line">        PageResp&lt;SpectatorQueryResp&gt; pageResp = <span class="keyword">new</span> <span class="title class_">PageResp</span>&lt;&gt;();</span><br><span class="line">        pageResp.setTotal(pageInfo.getTotal());</span><br><span class="line">        pageResp.setList(list);</span><br><span class="line">        <span class="keyword">return</span> pageResp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpectatorController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.member.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.contxet.LoginMemberContext;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.CommonResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.common.resp.PageResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorQueryReq;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.req.SpectatorSaveReq;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.resp.SpectatorQueryResp;</span><br><span class="line"><span class="keyword">import</span> com.star.xsport.member.service.SpectatorService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> jakarta.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/spectator&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpectatorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SpectatorService spectatorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResp&lt;Object&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> SpectatorSaveReq req)</span>&#123;</span><br><span class="line">        spectatorService.save (req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResp</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query-list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResp&lt;PageResp&lt;SpectatorQueryResp&gt;&gt; <span class="title function_">queryList</span><span class="params">(<span class="meta">@Valid</span> SpectatorQueryReq req)</span>&#123;</span><br><span class="line">        req.setMemberId(LoginMemberContext.getId());</span><br><span class="line">        PageResp&lt;SpectatorQueryResp&gt; list=spectatorService.queryList (req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResp</span>&lt;&gt;(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>common中PageResp.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star.xsport.common.resp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResp</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前页的列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getTotal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotal</span><span class="params">(Long total)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setList</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PageResp&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;total=&quot;</span> + total +</span><br><span class="line">                <span class="string">&quot;, list=&quot;</span> + list +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-10"><a href="#4-10" class="headerlink" title="4.10"></a>4.10</h3><blockquote>
<p>观赛人列表查询界面开发: 引入表格组件</p>
</blockquote>
<p>这一部分也是前端js的改动较多，直接放结果</p>
<h3 id="4-10-2"><a href="#4-10-2" class="headerlink" title="4.10(2)"></a>4.10(2)</h3><blockquote>
<p> 观赛人列表查询界面开发: 使用axios调用后端查询接口</p>
</blockquote>
<h3 id="4-10-3"><a href="#4-10-3" class="headerlink" title="4.10(3)"></a>4.10(3)</h3><blockquote>
<p>观赛人列表查询界面开发: 显示分页页码</p>
</blockquote>
<h3 id="4-10-4"><a href="#4-10-4" class="headerlink" title="4.10(4)"></a>4.10(4)</h3><blockquote>
<p>观赛人列表查询界面开发: 增加表格分页点击事件</p>
</blockquote>
<h3 id="4-10-5"><a href="#4-10-5" class="headerlink" title="4.10(5)"></a>4.10(5)</h3><blockquote>
<p>观赛人列表查询界面开发: 增加刷新按钮，点击查询第1页</p>
</blockquote>
<h3 id="4-10-6"><a href="#4-10-6" class="headerlink" title="4.10(6)"></a>4.10(6)</h3><blockquote>
<p>观赛人列表查询界面开发: 增加刷新按钮，点击查询第1页</p>
</blockquote>
<h3 id="4-10-7"><a href="#4-10-7" class="headerlink" title="4.10(7)"></a>4.10(7)</h3><blockquote>
<p>观赛人列表查询界面开发: 保存成功后刷新列表</p>
</blockquote>
<p>spectator.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;a-space&gt;</span><br><span class="line">      &lt;a-button type=&quot;primary&quot; @click=&quot;handleQuery()&quot;&gt;刷新&lt;/a-button&gt;</span><br><span class="line">      &lt;a-button type=&quot;primary&quot; @click=&quot;showModal&quot;&gt;新增&lt;/a-button&gt;</span><br><span class="line">    &lt;/a-space&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  &lt;a-table :dataSource=&quot;spectators&quot;</span><br><span class="line">           :columns=&quot;columns&quot;</span><br><span class="line">           :pagination=&quot;pagination&quot;</span><br><span class="line">           @change=&quot;handleTableChange&quot;</span><br><span class="line">           :loading=&quot;loading&quot;/&gt;</span><br><span class="line">  &lt;a-modal v-model:visible=&quot;visible&quot; title=&quot;观赛人&quot; @ok=&quot;handleOk&quot; ok-text=&quot;确认&quot; cancel-text=&quot;取消&quot;&gt;</span><br><span class="line">    &lt;a-form :model=&quot;spectator&quot; :label-col=&quot;&#123;span: 4&#125;&quot; :wrapper-col=&quot;&#123;&#125;&quot;&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;姓名&quot;&gt;</span><br><span class="line">        &lt;a-input v-model:value=&quot;spectator.name&quot;/&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;身份证&quot;&gt;</span><br><span class="line">        &lt;a-input v-model:value=&quot;spectator.idCard&quot;/&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">      &lt;a-form-item label=&quot;类型&quot;&gt;</span><br><span class="line">        &lt;a-select v-model:value=&quot;spectator.type&quot;&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;1&quot;&gt;成人&lt;/a-select-option&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;2&quot;&gt;儿童&lt;/a-select-option&gt;</span><br><span class="line">          &lt;a-select-option value=&quot;3&quot;&gt;学生&lt;/a-select-option&gt;</span><br><span class="line">        &lt;/a-select&gt;</span><br><span class="line">      &lt;/a-form-item&gt;</span><br><span class="line">    &lt;/a-form&gt;</span><br><span class="line">  &lt;/a-modal&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; defineComponent,ref,reactive,onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import axios from &quot;axios&quot;;</span><br><span class="line">import &#123;notification&#125; from &quot;ant-design-vue&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;passenger-view&quot;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const visible=ref(false);</span><br><span class="line"></span><br><span class="line">    const spectator = reactive(&#123;</span><br><span class="line">      id: undefined,</span><br><span class="line">      memberId: undefined,</span><br><span class="line">      name: undefined,</span><br><span class="line">      idCard:undefined,</span><br><span class="line">      type: undefined,</span><br><span class="line">      createTime:undefined,</span><br><span class="line">      updateTime:undefined,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const showModal =()=&gt;&#123;</span><br><span class="line">      visible.value=true;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const spectators= ref([]);</span><br><span class="line"></span><br><span class="line">    //分页的三个属性名是固定的</span><br><span class="line">    const pagination=reactive(&#123;</span><br><span class="line">      total:0,</span><br><span class="line">      current:1,</span><br><span class="line">      pageSize:2,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    let loading =ref(false);</span><br><span class="line"></span><br><span class="line">    const columns=[&#123;</span><br><span class="line">      title:&#x27;姓名&#x27;,</span><br><span class="line">      dataIndex:&#x27;name&#x27;,</span><br><span class="line">      key:&#x27;name&#x27;,</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      title:&#x27;身份证&#x27;,</span><br><span class="line">      dataIndex: &#x27;idCard&#x27;,</span><br><span class="line">      key:&#x27;idCard&#x27;,</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      title:&#x27;类型&#x27;,</span><br><span class="line">      dataIndex: &#x27;type&#x27;,</span><br><span class="line">      key:&#x27;type&#x27;,</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    const handleOk =()=&gt;&#123;</span><br><span class="line">      axios.post(&quot;/member/spectator/save&quot;,spectator).then((response)=&gt;&#123;</span><br><span class="line">        let data=response.data;</span><br><span class="line">        if(data.success)&#123;</span><br><span class="line">          notification.success(&#123;description:&quot;添加成功&quot;&#125;);</span><br><span class="line">          visible.value=false;</span><br><span class="line">          handleQuery(&#123;</span><br><span class="line">            page:pagination.current,</span><br><span class="line">            size:pagination.pageSize</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">          notification.error(&#123;description:data.message&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const handleQuery= (param)=&gt;&#123;</span><br><span class="line">      if(!param)&#123;</span><br><span class="line">        param=&#123;</span><br><span class="line">          page: 1,</span><br><span class="line">          size: pagination.pageSize</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      loading.value=true;</span><br><span class="line">      axios.get(&quot;/member/spectator/query-list&quot;,&#123;</span><br><span class="line">        params:&#123;</span><br><span class="line">          page:param.page,</span><br><span class="line">          size:param.size</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).then((response)=&gt;&#123;</span><br><span class="line">        loading.value=false;</span><br><span class="line">        let data=response.data;</span><br><span class="line">        if(data.success)&#123;</span><br><span class="line">          spectators.value=data.content.list;</span><br><span class="line">          //设置分页控件的值</span><br><span class="line">          pagination.current=param.page;</span><br><span class="line">          pagination.total=data.content.total;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          notification.error(&#123;description: data.message&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const handleTableChange=(pagination)=&gt;&#123;</span><br><span class="line">      handleQuery(&#123;</span><br><span class="line">        page:pagination.current,</span><br><span class="line">        size:pagination.pageSize,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(()=&gt;&#123;</span><br><span class="line">      handleQuery(&#123;</span><br><span class="line">        page:1,</span><br><span class="line">        size:pagination.pageSize,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      visible,</span><br><span class="line">      spectator,</span><br><span class="line">      showModal,</span><br><span class="line">      handleOk,</span><br><span class="line">      spectators,</span><br><span class="line">      columns,</span><br><span class="line">      handleQuery,</span><br><span class="line">      pagination,</span><br><span class="line">      handleTableChange,</span><br><span class="line">      loading,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>SpectatorService.java中加入spectatorExample.setOrderByClause(“id desc”);</p>
<p>让查询结果降序输出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResp&lt;SpectatorQueryResp&gt; <span class="title function_">queryList</span><span class="params">(SpectatorQueryReq req)</span>&#123;</span><br><span class="line">    <span class="type">SpectatorExample</span> <span class="variable">spectatorExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpectatorExample</span>();</span><br><span class="line">    spectatorExample.setOrderByClause(<span class="string">&quot;id desc&quot;</span>);</span><br><span class="line">    SpectatorExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> spectatorExample.createCriteria();</span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNotNull(req.getMemberId()))&#123;</span><br><span class="line">        criteria.andMemberIdEqualTo(req.getMemberId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LOG.info(<span class="string">&quot;查询页码:&#123;&#125;&quot;</span>,req.getPage());</span><br><span class="line">    LOG.info(<span class="string">&quot;每页条数:&#123;&#125;&quot;</span>,req.getSize());</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(req.getPage(),req.getSize()); <span class="comment">//对这句往下遇到的第一个SQL做拦截，增加分页limit</span></span><br><span class="line">    List&lt;Spectator&gt; spectatorList = spectatorMapper.selectByExample(spectatorExample);</span><br><span class="line"></span><br><span class="line">    PageInfo&lt;Spectator&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(spectatorList);</span><br><span class="line">    LOG.info(<span class="string">&quot;总行数:&#123;&#125;&quot;</span>,pageInfo.getTotal());</span><br><span class="line">    LOG.info(<span class="string">&quot;总页数:&#123;&#125;&quot;</span>,pageInfo.getPages());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;SpectatorQueryResp&gt; list = BeanUtil.copyToList(spectatorList, SpectatorQueryResp.class);</span><br><span class="line">    PageResp&lt;SpectatorQueryResp&gt; pageResp = <span class="keyword">new</span> <span class="title class_">PageResp</span>&lt;&gt;();</span><br><span class="line">    pageResp.setTotal(pageInfo.getTotal());</span><br><span class="line">    pageResp.setList(list);</span><br><span class="line">    <span class="keyword">return</span> pageResp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-11"><a href="#4-11" class="headerlink" title="4.11"></a>4.11</h3><p>date:3.12</p>
<blockquote>
<p>解决前后端交互Long类型精度丢失的问题</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerialize(using = ToStringSerializer.class)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonSerialize(using = ToStringSerializer.class)</span></span><br><span class="line">p</span><br></pre></td></tr></table></figure>

<p>在Long类型的属性上加上此注解。</p>
<h4 id="前后端的Long类型精度不一样，前端Long的精度比后端少两位，可以用注解的方式对Long类型对象转为字符串-JsonSerialize-using-ToStringSerializer-class"><a href="#前后端的Long类型精度不一样，前端Long的精度比后端少两位，可以用注解的方式对Long类型对象转为字符串-JsonSerialize-using-ToStringSerializer-class" class="headerlink" title="前后端的Long类型精度不一样，前端Long的精度比后端少两位，可以用注解的方式对Long类型对象转为字符串@JsonSerialize(using &#x3D; ToStringSerializer.class)"></a><strong>前后端的Long类型精度不一样，前端Long的精度比后端少两位，可以用注解的方式对Long类型对象转为字符串@JsonSerialize(using &#x3D; ToStringSerializer.class)</strong></h4><p><strong>第一种方式：</strong></p>
<p><strong>Jackson有个配置参数<code>WRITE_NUMBERS_AS_STRINGS</code>，可以强制将所有数字全部转成字符串输出。其功能介绍为：<code>Feature that forces all Java numbers to be written as JSON strings.</code>。使用方法很简单，只需要配置参数即可：</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    generator:</span><br><span class="line">      write_numbers_as_strings: true</span><br></pre></td></tr></table></figure>

<p><strong>这种方式的优点是使用方便，不需要调整代码；缺点是颗粒度太大，所有的数字都被转成字符串输出了，包括按照timestamp格式输出的时间也是如此。</strong></p>
<p><strong>第二种方式：</strong></p>
<p><strong>使用注解<code>JsonSerialize</code>。</strong></p>
<p><strong>使用官方提供的Serializer</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerialize(using=ToStringSerializer.class)</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">Long</span> bankcardHash;</span><br></pre></td></tr></table></figure>

<p><strong>指定了<code>ToStringSerializer</code>进行序列化，将数字编码成字符串格式。这种方式的优点是颗粒度可以很精细；缺点同样是太精细，如果需要调整的字段比较多会比较麻烦。</strong></p>
<hr>
<h3 id="4-12"><a href="#4-12" class="headerlink" title="4.12"></a>4.12</h3><blockquote>
<p>观赛人编辑接口开发</p>
</blockquote>
<p>http测试：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8000/member/spectator/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">token</span><span class="punctuation">: </span>&#123;&#123;token&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: 1899028041108164608,</span><br><span class="line">  &quot;memberId&quot;: 1896222866148560896,</span><br><span class="line">  &quot;name&quot;: &quot;test123&quot;,</span><br><span class="line">  &quot;idCard&quot;: &quot;123321&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###</span><br></pre></td></tr></table></figure>

<p>SpectatorService.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(SpectatorSaveReq req)</span>&#123;</span><br><span class="line">    <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span>DateTime.now();</span><br><span class="line">    <span class="type">Spectator</span> <span class="variable">spectator</span> <span class="operator">=</span> BeanUtil.copyProperties(req, Spectator.class);</span><br><span class="line">    <span class="keyword">if</span>(ObjectUtil.isNull(spectator.getId()))&#123;   <span class="comment">//为空说明是在进行新增操作</span></span><br><span class="line">        spectator.setMemberId(LoginMemberContext.getId());</span><br><span class="line">        spectator.setId(SnowUtil.getSnowflakeNextId());</span><br><span class="line">        spectator.setCreateTime(now);</span><br><span class="line">        spectator.setUpdateTime(now);</span><br><span class="line">        spectatorMapper.insert(spectator);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  <span class="comment">//不为空说明是在进行更新操作</span></span><br><span class="line">        spectator.setUpdateTime(now);</span><br><span class="line">        spectatorMapper.updateByPrimaryKey(spectator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-12-2"><a href="#4-12-2" class="headerlink" title="4.12(2)"></a>4.12(2)</h3><blockquote>
<p>观赛人编辑界面开发，reactive都改为ref，reactive需要再封装一层属性才能实现双向绑定，否则赋值后会失去响应式的特征。在此基础上解决没保存也会同步修改列表的问题</p>
</blockquote>
<p>Web中加入tool：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tool</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 空校验 null或&quot;&quot;都返回true</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">isEmpty</span>: <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">typeof</span> obj === <span class="string">&#x27;string&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> !obj || obj.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>) === <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (!obj || <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj) === <span class="string">&quot;&#123;&#125;&quot;</span> || obj.<span class="property">length</span> === <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 非空校验</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">isNotEmpty</span>: <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title class_">Tool</span>.<span class="title function_">isEmpty</span>(obj);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 对象复制</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">obj</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">copy</span>: <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Tool</span>.<span class="title function_">isNotEmpty</span>(obj)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 使用递归将数组转为树形结构</span></span><br><span class="line"><span class="comment">   * 父ID属性为parent</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">array2Tree</span>: <span class="function">(<span class="params">array, parentId</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Tool</span>.<span class="title function_">isEmpty</span>(array)) &#123;</span><br><span class="line">      <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; array.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> c = array[i];</span><br><span class="line">      <span class="comment">// console.log(Number(c.parent), Number(parentId));</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Number</span>(c.<span class="property">parent</span>) === <span class="title class_">Number</span>(parentId)) &#123;</span><br><span class="line">        result.<span class="title function_">push</span>(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 递归查看当前节点对应的子节点</span></span><br><span class="line">        <span class="keyword">const</span> children = <span class="title class_">Tool</span>.<span class="title function_">array2Tree</span>(array, c.<span class="property">id</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Tool</span>.<span class="title function_">isNotEmpty</span>(children)) &#123;</span><br><span class="line">          c.<span class="property">children</span> = children;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 随机生成[len]长度的[radix]进制数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">len</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> radix 默认62</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">string</span>&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">uuid</span>: <span class="function">(<span class="params">len, radix = <span class="number">62</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chars = <span class="string">&#x27;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> uuid = [];</span><br><span class="line">    radix = radix || chars.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      uuid[i] = chars[<span class="number">0</span> | <span class="title class_">Math</span>.<span class="title function_">random</span>() * radix];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> uuid.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>index.html中引入tool；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;js/tool.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>前端增加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const onEdit = (record)=&gt;&#123;</span><br><span class="line">  spectator.value= window.Tool.copy(record);</span><br><span class="line">  visible.value=true;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;a-table :dataSource=&quot;spectators&quot;</span><br><span class="line">         :columns=&quot;columns&quot;</span><br><span class="line">         :pagination=&quot;pagination&quot;</span><br><span class="line">         @change=&quot;handleTableChange&quot;</span><br><span class="line">         :loading=&quot;loading&quot;&gt;</span><br><span class="line">  &lt;template #bodyCell=&quot;&#123; column,record&#125;&quot;&gt;</span><br><span class="line">    &lt;template v-if=&quot;column.dataIndex === &#x27;operation&#x27;&quot;&gt;</span><br><span class="line">      &lt;a-space&gt;</span><br><span class="line">        &lt;a @click=&quot;onEdit(record)&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">      &lt;/a-space&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/a-table&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-13"><a href="#4-13" class="headerlink" title="4.13"></a>4.13</h3><blockquote>
<p>观赛人删除界面开发</p>
</blockquote>
<p>删除按钮放在编辑按钮旁边</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-if=&quot;column.dataIndex === &#x27;operation&#x27;&quot;&gt;</span><br><span class="line">       &lt;a-space&gt;</span><br><span class="line">         &lt;a-popconfirm</span><br><span class="line">             title=&quot;删除后不可恢复，确认删除?&quot;</span><br><span class="line">             @confirm=&quot;onDelete(record)&quot;</span><br><span class="line">             ok-text=&quot;确认&quot;</span><br><span class="line">             cancel-texk=&quot;取消&quot;&gt;</span><br><span class="line">           &lt;a style=&quot;color: red&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">         &lt;/a-popconfirm&gt;</span><br><span class="line">         &lt;a @click=&quot;onEdit(record)&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">       &lt;/a-space&gt;</span><br><span class="line">     &lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>删除axios请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onDelete</span> =(<span class="params">record</span>)=&gt;&#123;</span><br><span class="line">  axios.<span class="title function_">delete</span>(<span class="string">&quot;/member/spectator/delete/&quot;</span> + record.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data= response.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">success</span>)&#123;</span><br><span class="line">      notification.<span class="title function_">success</span>(&#123;<span class="attr">description</span>:<span class="string">&quot;删除成功!&quot;</span>&#125;);</span><br><span class="line">      <span class="title function_">handleQuery</span>(&#123;</span><br><span class="line">        <span class="attr">page</span>:pagination.<span class="property">value</span>.<span class="property">current</span>,</span><br><span class="line">        <span class="attr">size</span>:pagination.<span class="property">value</span>.<span class="property">pageSize</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      notification.<span class="title function_">error</span>(&#123;<span class="attr">description</span>:data.<span class="property">message</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>删除http测试：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">DELETE http://localhost:8000/member/spectator/delete/1898325614805520384</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">token</span><span class="punctuation">: </span>&#123;&#123;token&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void delete(Long id)&#123;</span><br><span class="line">    spectatorMapper.deleteByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResp&lt;Object&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    spectatorService.delete (id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResp</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-14"><a href="#4-14" class="headerlink" title="4.14"></a>4.14</h3><blockquote>
<p>将下拉框的值提取成常量数组</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a-select-option v-for=&quot;item in SPECTATOR_TYPE_ARRAY&quot; :key=&quot;item.key&quot; :value=&quot;item.key&quot;&gt;&#123;&#123;item.value&#125;&#125;&lt;/a-select-option&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">SPECTATOR_TYPE_ARRAY</span>=[&#123;<span class="attr">key</span>: <span class="string">&quot;1&quot;</span> , <span class="attr">value</span>:<span class="string">&quot;成人1&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;儿童2&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">value</span>: <span class="string">&quot;学生3&quot;</span>&#125;];</span><br></pre></td></tr></table></figure>

<h3 id="4-14-2"><a href="#4-14-2" class="headerlink" title="4.14(2)"></a>4.14(2)</h3><blockquote>
<p>解决表格中枚举字段的显示</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-else-if=&quot;column.dataIndex===&#x27;type&#x27;&quot;&gt;</span><br><span class="line">  &lt;span v-for=&quot;item in SPECTATOR_TYPE_ARRAY&quot; :key=&quot;item.key&quot;&gt;</span><br><span class="line">    &lt;span v-if=&quot;item.key===record.type&quot;&gt;</span><br><span class="line">      &#123;&#123;item.value&#125;&#125;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/span&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">SPECTATOR_TYPE_ARRAY</span>=[&#123;<span class="attr">key</span>: <span class="string">&quot;1&quot;</span> , <span class="attr">value</span>:<span class="string">&quot;成人&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;儿童&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">value</span>: <span class="string">&quot;学生&quot;</span>&#125;];</span><br></pre></td></tr></table></figure>

<h3 id="4-14-3"><a href="#4-14-3" class="headerlink" title="4.14(3)"></a>4.14(3)</h3><blockquote>
<p>将枚举数组放入单独的文件中</p>
</blockquote>
<p>在web&#x2F;src&#x2F;assets&#x2F;js下创建enums.js</p>
<p>用于存放前端枚举</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">SPECTATOR_TYPE_ARRAY</span>=[&#123;<span class="attr">key</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;成人&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;儿童&quot;</span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;学生&quot;</span>&#125;];</span><br></pre></td></tr></table></figure>

<p>main.js中引入文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/js/enums&#x27;</span></span><br></pre></td></tr></table></figure>



<p>这样前端js可以改成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">SPECTATOR_TYPE_ARRAY</span>=<span class="variable language_">window</span>.<span class="property">SPECTATOR_TYPE_ARRAY</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p>这一章学习了JWT单点登录功能，以及对前端部分功能的补充。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Astra</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/">http://example.com/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">ASTRA</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/01/Learn%20by%20heart/" title="Learn by heart"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Learn by heart</div></div><div class="info-2"><div class="info-item-1">三月一，26℃艳阳，出冬了吗？ ​		自认为算不上所谓的“真爱粉”，也根本不在乎于此，但就是莫名难受。喜欢他对生活的乐观、对音乐的纯粹。对我而言，他留给我去学习的够多了。 ​		成长是 永远 离别是 空悬。可能成长就是要学会接受吧。接受不喜欢吃的菜，接受晦涩难懂的知识，接受不一样的生活方式，接受各种突然的意外，接受事物的悄然离别。我想离别本不是伤感，是告示我们又要找寻新的目标接着成长的标识。 ​		低头前进许久，恍驻步抬头，思生命、究价值、拾风景。  在千寻之外，你依然存在   </div></div></div></a><a class="pagination-related" href="/2025/03/13/%E6%98%9F%E8%BF%90%E5%8A%A8(%E5%9B%9B)/" title="星运动(四)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">星运动(四)</div></div><div class="info-2"><div class="info-item-1">自制前后端代码生成器，提高开发效率如果要从事程序员，那这一章的内容对生涯或多或少有帮助。 用增删改查为模版，自制单表管理，前后端生成器，生成controller，service，req，resp，enum，vue 本章收获： 学习代码生成器原理，学习freemarker 学会写自己的生成器，可用于导出复制excel，页面静态化等。  5.1date：3.12  集成dom4j,读取pom.xml，得到当前持久层的xml文件  generator的pom中加入依赖： 1234567891011121314151617181920&lt;dependencies&gt;    &lt;!--模版引擎freemarker--&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.freemarker&lt;/groupId&gt;        &lt;artifactId&gt;freemarker&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!--读xml--&gt;   ...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Astra</div><div class="author-info-description">Grace Under Pressure</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/YuAstra"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#title-java%E9%A1%B9%E7%9B%AE-%E4%B8%89-date-2025-03-06-14-47-11tags"><span class="toc-number">1.</span> <span class="toc-text">title: java项目(三)date: 2025-03-06 14:47:11tags:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1"><span class="toc-number">1.1.</span> <span class="toc-text">3.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2"><span class="toc-number">1.2.</span> <span class="toc-text">3.2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%90%E5%80%BC%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%8C%E6%98%AF%E5%AF%86%E9%92%A5%EF%BC%8C%E5%AF%B9token%E5%8A%A0%E5%AF%86%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%88%AB%E4%BA%BA%E7%9F%A5%E9%81%93%E6%98%AF%E7%94%A8%E7%9A%84hutool%EF%BC%8C%E4%B9%9F%E7%94%A8hutool%E6%9D%A5%E8%A7%A3%E5%AF%86%EF%BC%8C%E6%9C%89%E5%AF%86%E9%92%A5%E5%B0%B1%E4%B8%8D%E4%BC%9A%E7%AE%80%E5%8D%95%E7%9A%84%E8%A2%AB%E8%A7%A3%E5%AF%86%E3%80%82"><span class="toc-number">1.2.1.</span> <span class="toc-text">盐值很重要，是密钥，对token加密，防止别人知道是用的hutool，也用hutool来解密，有密钥就不会简单的被解密。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3"><span class="toc-number">1.3.</span> <span class="toc-text">3.3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4"><span class="toc-number">1.4.</span> <span class="toc-text">3.4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E4%B9%8B%E5%89%8Dstore%E4%B8%AD%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%8F%AA%E6%98%AF%E7%BC%93%E5%AD%98%E4%BA%86%E4%B8%80%E4%B8%8B%EF%BC%8C%E8%80%8C%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E5%90%8E%E3%80%81%E6%88%96%E6%98%AF%E8%B7%B3%E8%BD%AC%E5%85%B6%E4%BB%96%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%8E%9F%E4%BF%9D%E5%AD%98%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B0%B1%E4%BC%9A%E4%B8%A2%E5%A4%B1%E3%80%82"><span class="toc-number">1.4.1.</span> <span class="toc-text">在之前store中存储的数据相当于只是缓存了一下，而页面刷新后、或是跳转其他页面，原保存的数据就会丢失。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%B8%AA%E7%89%B9%E4%BE%8B%EF%BC%8C%E4%B8%80%E5%AE%9A%E8%A6%81%E5%92%8C%E5%8C%B9%E9%85%8D%E3%80%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">&lt;script&gt;是个特例，一定要和&lt;&#x2F;script&gt;匹配。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5"><span class="toc-number">1.5.</span> <span class="toc-text">3.5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%A1%A8%E6%98%8E%EF%BC%8C%E5%A4%9A%E4%B8%AAgateway%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%98%AF%E6%8C%89%E7%85%A7Ordered%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84getOrder-%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E7%9A%84%E6%95%B0%E5%80%BC%E4%BB%8E%E5%B0%8F%E5%88%B0%E5%A4%A7%E6%89%A7%E8%A1%8C%E7%9A%84%E3%80%82"><span class="toc-number">1.5.1.</span> <span class="toc-text">测试表明，多个gateway过滤器的顺序是按照Ordered接口中的getOrder()方法返回的数值从小到大执行的。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6"><span class="toc-number">1.6.</span> <span class="toc-text">3.6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7"><span class="toc-number">1.7.</span> <span class="toc-text">3.7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8"><span class="toc-number">1.8.</span> <span class="toc-text">3.8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9"><span class="toc-number">1.9.</span> <span class="toc-text">3.9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1"><span class="toc-number">1.10.</span> <span class="toc-text">4.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2"><span class="toc-number">1.11.</span> <span class="toc-text">4.2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2"><span class="toc-number">1.12.</span> <span class="toc-text">4.2(2)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9AmemberId%E6%98%AFLong%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%B8%8D%E8%83%BD%E7%94%A8-NotBlank%EF%BC%8C%E8%80%8C%E5%BA%94%E8%AF%A5%E7%94%A8-NotNull"><span class="toc-number">1.12.1.</span> <span class="toc-text">注：memberId是Long类型，不能用@NotBlank，而应该用@NotNull</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3"><span class="toc-number">1.13.</span> <span class="toc-text">4.3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4"><span class="toc-number">1.14.</span> <span class="toc-text">4.4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5"><span class="toc-number">1.15.</span> <span class="toc-text">4.5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6"><span class="toc-number">1.16.</span> <span class="toc-text">4.6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-2"><span class="toc-number">1.17.</span> <span class="toc-text">4.6(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7"><span class="toc-number">1.18.</span> <span class="toc-text">4.7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2"><span class="toc-number">1.19.</span> <span class="toc-text">4.7(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-3"><span class="toc-number">1.20.</span> <span class="toc-text">4.7(3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8"><span class="toc-number">1.21.</span> <span class="toc-text">4.8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9"><span class="toc-number">1.22.</span> <span class="toc-text">4.9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-2"><span class="toc-number">1.23.</span> <span class="toc-text">4.9(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-3"><span class="toc-number">1.24.</span> <span class="toc-text">4.9(3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-4"><span class="toc-number">1.25.</span> <span class="toc-text">4.9(4)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10"><span class="toc-number">1.26.</span> <span class="toc-text">4.10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-2"><span class="toc-number">1.27.</span> <span class="toc-text">4.10(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-3"><span class="toc-number">1.28.</span> <span class="toc-text">4.10(3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-4"><span class="toc-number">1.29.</span> <span class="toc-text">4.10(4)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-5"><span class="toc-number">1.30.</span> <span class="toc-text">4.10(5)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-6"><span class="toc-number">1.31.</span> <span class="toc-text">4.10(6)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-7"><span class="toc-number">1.32.</span> <span class="toc-text">4.10(7)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11"><span class="toc-number">1.33.</span> <span class="toc-text">4.11</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84Long%E7%B1%BB%E5%9E%8B%E7%B2%BE%E5%BA%A6%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%89%8D%E7%AB%AFLong%E7%9A%84%E7%B2%BE%E5%BA%A6%E6%AF%94%E5%90%8E%E7%AB%AF%E5%B0%91%E4%B8%A4%E4%BD%8D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AF%B9Long%E7%B1%BB%E5%9E%8B%E5%AF%B9%E8%B1%A1%E8%BD%AC%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2-JsonSerialize-using-ToStringSerializer-class"><span class="toc-number">1.33.1.</span> <span class="toc-text">前后端的Long类型精度不一样，前端Long的精度比后端少两位，可以用注解的方式对Long类型对象转为字符串@JsonSerialize(using &#x3D; ToStringSerializer.class)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-12"><span class="toc-number">1.34.</span> <span class="toc-text">4.12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-12-2"><span class="toc-number">1.35.</span> <span class="toc-text">4.12(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-13"><span class="toc-number">1.36.</span> <span class="toc-text">4.13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-14"><span class="toc-number">1.37.</span> <span class="toc-text">4.14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-14-2"><span class="toc-number">1.38.</span> <span class="toc-text">4.14(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-14-3"><span class="toc-number">1.39.</span> <span class="toc-text">4.14(3)</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/23/%E6%98%9F%E4%BD%93%E8%82%B2%E5%94%AE%E7%A5%A8%E5%B9%B3%E5%8F%B0(%E5%85%AD)/" title="星体育售票平台(六)">星体育售票平台(六)</a><time datetime="2025-03-23T11:26:14.000Z" title="发表于 2025-03-23 19:26:14">2025-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/14/%E6%98%9F%E8%BF%90%E5%8A%A8(%E4%BA%94)/" title="星运动(五)">星运动(五)</a><time datetime="2025-03-13T17:28:22.000Z" title="发表于 2025-03-14 01:28:22">2025-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/13/%E6%98%9F%E8%BF%90%E5%8A%A8(%E5%9B%9B)/" title="星运动(四)">星运动(四)</a><time datetime="2025-03-13T07:50:39.000Z" title="发表于 2025-03-13 15:50:39">2025-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/06/java%E9%A1%B9%E7%9B%AE(%E4%B8%89)/" title="无标题">无标题</a><time datetime="2025-03-06T06:47:11.823Z" title="发表于 2025-03-06 14:47:11">2025-03-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/01/Learn%20by%20heart/" title="Learn by heart">Learn by heart</a><time datetime="2025-03-01T14:46:49.000Z" title="发表于 2025-03-01 22:46:49">2025-03-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Astra</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.3</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>